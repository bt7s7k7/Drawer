(function(){"use strict";const f=class f{toStyle(){return`rgba(${Math.floor(Math.max(Math.min(this.r,1),0)*255)}, ${Math.floor(Math.max(Math.min(this.g,1),0)*255)}, ${Math.floor(Math.max(Math.min(this.b,1),0)*255)}, ${Math.max(Math.min(this.a,1),0)})`}lerp(t,e){return new f(this.r+(t.r-this.r)*e,this.g+(t.g-this.g)*e,this.b+(t.b-this.b)*e,this.a+(t.a-this.a)*e)}mul(t){return new f(this.r*t,this.g*t,this.b*t,this.a)}opacity(t){return new f(this.r,this.g,this.b,t)}toGreyscale(){return(this.r+this.g+this.b)/3}toHex(){return"#"+Math.min(255,Math.floor(this.r*255)).toString(16).padStart(2,"0")+Math.min(255,Math.floor(this.g*255)).toString(16).padStart(2,"0")+Math.min(255,Math.floor(this.b*255)).toString(16).padStart(2,"0")}toHSL(){const{r:t,g:e,b:i}=this,s=Math.min(t,e,i),r=Math.max(t,e,i),h=r-s;let o=0;h==0?o=0:r==t?o=(e-i)/h%6:r==e?o=(i-t)/h+2:o=(t-e)/h+4,o=o/6,o<0&&(o+=1);const l=(r+s)/2,u=h==0?0:h/(1-Math.abs(2*l-1));return{h:o,s:u,l}}invert(){return new f(1-this.r,1-this.g,1-this.b,this.a)}constructor(t,e,i,s){typeof t=="object"?(this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a??1):(this.r=t??0,this.g=e??0,this.b=i??0,this.a=s??1)}static fromCSS(t){if(t.startsWith("rgb")){const[e,i,s]=t.slice(4,-1).split(",").map(r=>+r);return new f(e/255,i/255,s/255)}if(t.startsWith("rgba")){const[e,i,s,r]=t.slice(4,-1).split(",").map(h=>+h);return new f(e/255,i/255,s/255,r/255)}if(t.startsWith("#"))return f.fromHex(t);if(t.startsWith("hsl")){const[e,i,s]=t.slice(4,-1).split(",").map(r=>+r);return new f(e/255,i/255,s/255)}throw new SyntaxError(`Unsupported color string "${t}"`)}static fromHex(t){let e=0;t[0]=="#"&&(e+=1);const i=parseInt(t.substr(e+0,2),16)/255,s=parseInt(t.substr(e+2,2),16)/255,r=parseInt(t.substr(e+4,2),16)/255;return new f(i,s,r)}static fromHSL(t,e,i){let s,r,h;if(e==0)s=r=h=i;else{const o=(y,g,m)=>(m<0&&(m+=1),m>1&&(m-=1),m<.16666666666666666?y+(g-y)*6*m:m<.5?g:m<.6666666666666666?y+(g-y)*(.6666666666666666-m)*6:y),l=i<.5?i*(1+e):i+e-i*e,u=2*i-l;s=o(u,l,t+1/3),r=o(u,l,t),h=o(u,l,t-1/3)}return new f(s,r,h)}};f.white=new f(1,1,1),f.black=new f(0,0,0),f.red=new f(1,0,0),f.green=new f(0,1,0),f.blue=new f(0,0,1),f.yellow=new f(1,1,0),f.cyan=new f(0,1,1),f.magenta=new f(1,0,1),f.orange=new f(1,.25,0),f.transparent=new f(0,0,0,0);let b=f;var Pt=Object.freeze({__proto__:null,Color:b});const a=class a{constructor(t=0,e=0){this.y=e,typeof t=="object"?(this.x=t.x,this.y=t.y):this.x=t}floor(){return new a(Math.floor(this.x),Math.floor(this.y))}round(){return new a(Math.round(this.x),Math.round(this.y))}makePixelPerfect(){return new a(Math.floor(this.x)+.5,Math.floor(this.y)+.5)}ceil(){return new a(Math.ceil(this.x),Math.ceil(this.y))}abs(){return new a(Math.abs(this.x),Math.abs(this.y))}normalize(){return this.x==0&&this.y==0?a.zero:this.mul(1/Math.hypot(this.x,this.y))}tangent(){return new a(this.y,-this.x)}toAngle(){return Math.atan2(this.y,this.x)}scale(t,e=0){return typeof t=="object"?new a(this.x*t.x,this.y*t.y):new a(this.x*t,this.y*e)}antiScale(t,e=0){return typeof t=="object"?new a(this.x/t.x,this.y/t.y):new a(this.x/t,this.y/e)}invert(){return new a(1/this.x,1/this.y)}static fromAngle(t){return new a(Math.cos(t),Math.sin(t))}spread(){return[this.x,this.y]}mul(t){return new a(this.x*t,this.y*t)}pow(t){return new a(this.x**t,this.y**t)}add(t,e=0){return typeof t=="object"?new a(this.x+t.x,this.y+t.y):new a(this.x+t,this.y+e)}sub(t,e=0){return typeof t=="object"?new a(this.x-t.x,this.y-t.y):new a(this.x-t,this.y-e)}makeKey(){return`${this.x}:${this.y}`}hash(){const t=this.x*12.9898+this.y*78.233,e=Math.sin(t)*43758.5453;return e-Math.floor(e)}dist(t){return Math.hypot(this.x-t.x,this.y-t.y)}isZero(){return this.x===0&&this.y===0}isNaN(){return isNaN(this.x)||isNaN(this.y)}size(){return Math.hypot(this.x,this.y)}sizeSqr(){return this.x**2+this.y**2}clampSize(t){return Math.hypot(this.x,this.y)>t?this.normalize().mul(t):this}area(){return this.x*this.y}equals(t){return this.x==t.x&&this.y==t.y}with(t,e){return new a({...this,[t]:e})}*[Symbol.iterator](){yield this.x,yield this.y}static dot(t,e){return t.x*e.x+t.y*e.y}static project(t,e,i){const s=i.add(t.mul(-1));return{length:this.dot(e,s),point(){return t.add(e.mul(this.length))},pointClamped(h){return t.add(e.mul(this.length<0?0:this.length>h?h:this.length))}}}static cardinalDirection(t,e){const i=e.add(t.mul(-1)),s=Math.abs(i.x),r=Math.abs(i.y);return s>r?new a(i.x,0):new a(0,i.y)}lerp(t,e){return this.add(t.add(this.mul(-1)).mul(e))}static min(t,e){return new a(Math.min(t.x,e.x),Math.min(t.y,e.y))}static max(t,e){return new a(Math.max(t.x,e.x),Math.max(t.y,e.y))}static dist(t,e){return Math.hypot(t.x-e.x,t.y-e.y)}static distSqr(t,e){return(t.x-e.x)**2+(t.y-e.y)**2}static calculateObjectFit(t,e,i){const s=t.x/e.x,r=t.y/e.y;return i=="contain"?Math.min(1/s,1/r):i=="cover"?Math.max(1/s,1/r):(s>1||r>1,Math.min(1/s,1/r))}static getLineIntersectionScalars(t,e,i,s){const r=s.y*e.x-s.x*e.y;if(r==0)return[1/0,1/0];const h=(s.x*(t.y-i.y)-s.y*(t.x-i.x))/r,o=(e.x*(t.y-i.y)-e.y*(t.x-i.x))/r;return[h,o]}static getLineIntersection(t,e,i,s){const r=this.getLineIntersectionScalars(t,e,i,s)[0];return t.add(e.mul(r))}};a.one=new a(1,1),a.zero=new a,a.up=new a(0,-1),a.down=new a(0,1),a.left=new a(-1,0),a.right=new a(1,0),a.NaN=new a(NaN,NaN),a.directions=[a.up,a.right,a.down,a.left];let c=a;var Lt=Object.freeze({__proto__:null,Point:c});const d=class d{constructor(t=0,e=0,i=0,s=0){if(this.width=i,this.height=s,typeof t=="object")this.x=t.x,this.y=t.y,"width"in t?(this.width=t.width,this.height=t.height):typeof e=="object"?(this.width=e.x,this.height=e.y):(this.width=e,this.height=i);else if(this.x=t,typeof e=="number")this.y=e;else throw new TypeError("y can only be an object if x is point")}size(){return new c(this.width,this.height)}pos(){return new c(this.x,this.y)}makePixelPerfect(){return new d(Math.floor(this.x)+.5,Math.floor(this.y)+.5,Math.floor(this.width),Math.floor(this.height))}floor(){return new d(Math.floor(this.x),Math.floor(this.y),Math.floor(this.width),Math.floor(this.height))}with(t,e){return new d({...this,[t]:e})}spread(){return[this.x,this.y,this.width,this.height]}origin(){return new d(0,0,this.width,this.height)}mul(t){return new d(this.x,this.y,this.width*t,this.height*t)}mulAll(t){return new d(this.x*t,this.y*t,this.width*t,this.height*t)}end(){return new c(this.x+this.width,this.y+this.height)}translate(t,e=0){return typeof t=="object"?new d(this.x+t.x,this.y+t.y,this.width,this.height):new d(this.x+t,this.y+e,this.width,this.height)}expand(t,e=0){return typeof t=="object"?new d(this.x,this.y,this.width+t.x,this.height+t.y):new d(this.x,this.y,this.width+t,this.height+e)}copy(){return new d(this.x,this.y,this.width,this.height)}containsPoint(t){return t.x>=this.x&&t.x<this.x+this.width&&t.y>=this.y&&t.y<this.y+this.height}center(){return this.pos().add(this.size().mul(.5))}containsRect(t){let e=this.end(),i=t.end();return i.x>=this.x&&i.y>=this.y&&t.x<=e.x&&t.y<=e.y}equals(t){return this.x==t.x&&this.y==t.y&&this.width==t.width&&this.height==t.height}sizeEquals(t){return this.width==t.width&&this.height==t.height}awayVector(t){let e=0,i=0;const s=this.pos(),r=this.end();return t.x<s.x&&(e=-1),t.x>r.x&&(e=1),t.y<s.y&&(i=-1),t.y>r.y&&(i=1),new c(e,i)}area(){return this.width*this.height}clampPoint(t){return new c(Math.max(this.x,Math.min(this.x+this.width,t.x)),Math.max(this.y,Math.min(this.y+this.height,t.y)))}clampVector(t){let e=this.width*.5,i=this.height*.5,s=t.size();const r=t.mul(1/s);let h;r.x>0?h=new c(e,0):h=new c(-e,0);let o;r.y>0?o=new c(0,i):o=new c(0,-i);const[l]=c.getLineIntersectionScalars(c.zero,r,h,c.down),[u]=c.getLineIntersectionScalars(c.zero,r,o,c.right);return r.mul(Math.min(s,l,u))}scale(t){return new d(this.x,this.y,this.width*t.width,this.height*t.height)}antiScale(t){return new d(this.x,this.y,this.width/t.width,this.height/t.height)}ceilSize(){return new d(this.x,this.y,Math.ceil(this.width),Math.ceil(this.height))}getFracPoint(t,e){const i=e!=null?new c(t,e):new c(t);return this.pos().add(this.size().scale(i))}align(t){let e=0,i=0,s=0,r=0;return t.size!=null&&(t.width=t.height=t.size),t.padding!=null&&(t.top=t.left=t.right=t.bottom=t.padding),t.width!=null?(i=t.width,t.left!=null?e=t.left:t.right!=null?e=this.width-t.right-t.width:e=(this.width-i)/2):t.left!=null&&t.right!=null?(e=t.left,i=this.width-e-t.right):t.left!=null?(e=t.left,i=this.width-e):t.right!=null&&(i=this.width-t.right,e=0),t.height!=null?(r=t.height,t.top!=null?s=t.top:t.bottom!=null?s=this.height-t.bottom-t.height:s=(this.height-r)/2):t.top!=null&&t.bottom!=null?(s=t.top,r=this.height-s-t.bottom):t.top!=null?(s=t.top,r=this.height-s):t.bottom!=null&&(r=this.height-t.bottom,s=0),new d(e,s,i,r)}aspectRatio(t,e=!1){if(t>1){const i=this.height/t;if(i>this.width){const s=this.width/i,r=this.height*s;return new d(0,0,i*s,r)}return new d(0,0,i,this.height)}else{const i=this.width*t;if(i>this.height){const s=this.height/i,r=this.width*s;return new d(0,0,r,i*s)}return new d(0,0,this.width,i)}}min(){return new c(Math.min(this.x,this.x+this.width),Math.min(this.y,this.y+this.height))}max(){return new c(Math.max(this.x,this.x+this.width),Math.max(this.y,this.y+this.height))}snapToGrid(){const t=this.pos().floor(),e=this.end().ceil();return new d(t,e.sub(t))}static extends(t,e){return new d(t.add(e.mul(-.5)),e)}static fromDOMRect(t){return new d(t.left,t.top,t.width,t.height)}static fromSize(t){return new d(0,0,t.width,t.height)}static union(t){let e=1/0,i=1/0,s=-1/0,r=-1/0;for(const h of t){let o,l;"min"in h?(o=h.min(),l=h.max()):(o=h,l=h),e>o.x&&(e=o.x),i>o.y&&(i=o.y),s<l.x&&(s=l.x),r<l.y&&(r=l.y)}return new d(e,i,s-e,r-i)}};d.one=new d(0,0,1,1),d.zero=new d(0,0,0,0);let p=d;var Dt=Object.freeze({__proto__:null,Rect:p});const S=class S{constructor(t=1,e=0,i=0,s=0,r=1,h=0,o=0,l=0,u=1){this.m11=t,this.m21=e,this.m31=i,this.m12=s,this.m22=r,this.m32=h,this.m13=o,this.m23=l,this.m33=u}translate(){const t=arguments.length==2?arguments[0]:arguments[0].x,e=arguments.length==2?arguments[1]:arguments[0].y;return new S(this.m11,this.m21,this.m11*t+this.m21*e+this.m31,this.m12,this.m22,this.m12*t+this.m22*e+this.m32,this.m13,this.m23,this.m13*t+this.m23*e+this.m33)}rotate(t){const e=Math.cos(t),i=Math.sin(t);return new S(this.m11*e+this.m21*i+this.m31*0,this.m11*-i+this.m21*e+this.m31*0,this.m11*0+this.m21*0+this.m31*1,this.m12*e+this.m22*i+this.m32*0,this.m12*-i+this.m22*e+this.m32*0,this.m12*0+this.m22*0+this.m32*1,this.m13*e+this.m23*i+this.m33*0,this.m13*-i+this.m23*e+this.m33*0,this.m13*0+this.m23*0+this.m33*1)}transpose(){return new S(this.m11,this.m12,this.m13,this.m21,this.m22,this.m23,this.m31,this.m32,this.m33)}scale(){let t,e;return arguments.length==1?typeof arguments[0]=="number"?t=e=arguments[0]:(t=arguments[0].x,e=arguments[0].y):(t=arguments[0],e=arguments[1]),new S(this.m11*t,this.m21*e,this.m31,this.m12*t,this.m22*e,this.m32,this.m13*t,this.m23*e,this.m33)}mul(t){return new S(this.m11*t.m11+this.m21*t.m12+this.m31*t.m13,this.m11*t.m21+this.m21*t.m22+this.m31*t.m23,this.m11*t.m31+this.m21*t.m32+this.m31*t.m33,this.m12*t.m11+this.m22*t.m12+this.m32*t.m13,this.m12*t.m21+this.m22*t.m22+this.m32*t.m23,this.m12*t.m31+this.m22*t.m32+this.m32*t.m33,this.m13*t.m11+this.m23*t.m12+this.m33*t.m13,this.m13*t.m21+this.m23*t.m22+this.m33*t.m23,this.m13*t.m31+this.m23*t.m32+this.m33*t.m33)}transform(t){const e=t.x*this.m11,i=t.x*this.m12,s=t.x*this.m13,r=t.y*this.m21,h=t.y*this.m22,o=t.y*this.m23,l=this.m31,u=this.m32,y=this.m33,g=s+o+y,m=(e+r+l)/g,w=(i+h+u)/g;return new c(m,w)}transformVector(t){const e=t.x*this.m11,i=t.x*this.m12,s=t.x*this.m13,r=t.y*this.m21,h=t.y*this.m22,o=t.y*this.m23,l=0,u=0,y=1,g=s+o+y,m=(e+r+l)/g,w=(i+h+u)/g;return new c(m,w)}transformRect(t){const e=this.transform(t.pos()),i=this.transform(t.end());return new p(e,i.add(e.mul(-1)))}transformWithContext(t,e){return this.transform(t.antiScale(e.size())).scale(e.size())}isIdentity(){return this==S.identity?!0:this.m11==1&&this.m21==0&&this.m31==0&&this.m12==0&&this.m22==1&&this.m32==0&&this.m13==0&&this.m23==0&&this.m33==1}isEqual(t){return this==t?!0:this.m11==t.m11&&this.m12==t.m12&&this.m13==t.m13&&this.m21==t.m21&&this.m22==t.m22&&this.m23==t.m23&&this.m31==t.m31&&this.m32==t.m32&&this.m33==t.m33}get(t,e){if(t==0&&e==0)return this.m11;if(t==0&&e==1)return this.m12;if(t==0&&e==2)return this.m13;if(t==1&&e==0)return this.m21;if(t==1&&e==1)return this.m22;if(t==1&&e==2)return this.m23;if(t==2&&e==0)return this.m31;if(t==2&&e==1)return this.m32;if(t==2&&e==2)return this.m33;throw new RangeError("Matrix access out of range")}end(){return this.transform(c.zero)}toCSS(){return`matrix(${this.m11}, ${this.m21}, ${this.m12}, ${this.m22}, ${this.m31}, ${this.m32})`}static fromDOMMatrix(t){return new S(t.a,t.c,t.e,t.b,t.d,t.f,0,0,1)}};S.identity=new S;let T=S;var Bt=Object.freeze({__proto__:null,Matrix:T});const D=class D{constructor(t=D.CONTEXT_FACTORY(),e){this.ctx=t,this.size=new p,e=="fragile"?this.fragile=!0:e?this.fragile=e.fragile??!1:this.fragile=!1,this.fragile?this.size=new p(0,0,t.canvas.width,t.canvas.height):this.setNativeSize()}setStyle(t){return t instanceof b&&(t=t.toStyle()),this.ctx.fillStyle=t,this.ctx.strokeStyle=t,this}setFillStyle(t){return t instanceof b&&(t=t.toStyle()),this.ctx.fillStyle=t,this}setStrokeStyle(t){return t instanceof b&&(t=t.toStyle()),this.ctx.strokeStyle=t,this}setStrokeDash(t){return this.ctx.setLineDash(t),this}setStrokeDashOffset(t){return this.ctx.lineDashOffset=t,this}fillRect(t=this.size){return this.ctx.fillRect(...t.spread()),this}clear(){return this.setSize(this.size),this}strokeRect(t){return this.ctx.strokeRect(...t.spread()),this}fillText(t,e,i,s=""){if(typeof i=="number")return this.fillText(t,e,{size:i,font:s});{const r=globalThis.getComputedStyle?getComputedStyle(this.ctx.canvas):{get fontSize(){throw new Error("Inheriting size is not supported in this environment, please explicitly specify size in options")},get fontFamily(){throw new Error("Inheriting font is not supported in this environment, please explicitly specify font in options")}};let h=typeof i.size=="number"?i.size+"px":typeof i.size=="string"?i.size:r.fontSize,o=i.font?i.font:r.fontFamily,l=`${h} ${o}`;if(i.modifier&&(l=i.modifier+" "+l),this.ctx.font=l,this.ctx.font!==l)throw new Error(`Invalid font for drawer, size = ${h}, font = ${o} (ctx returned ${this.ctx.font})`);this.ctx.textAlign=i.align??"start",this.ctx.textBaseline=i.baseline??"alphabetic";const u=t.split(`
`),y=this.ctx.measureText(",Á"),g=y.actualBoundingBoxAscent+y.actualBoundingBoxDescent;return u.forEach((m,w)=>{let at=e.add(0,g*w);i.outline&&(typeof i.outline=="function"?i.outline({drawer:this,metrics:this.ctx.measureText(m),origin:at,size:+h.slice(0,-2),align:this.ctx.textAlign,baseline:this.ctx.textBaseline}):this.ctx.strokeText(m,...at.spread())),this.ctx.fillText(m,...at.spread())}),this}}setNativeSize(){if(this.fragile)throw new Error("Cannot set size of fragile canvas");const t=this.ctx.canvas,e=new p(0,0,"scrollWidth"in t?t.scrollWidth:t.width,"scrollHeight"in t?t.scrollHeight:t.height);return this.setSize(e),this}setSize(t){if(this.fragile)throw new Error("Cannot set size of fragile canvas");const e=this.ctx.canvas,i=t instanceof c?new p(new c,t):t.origin();return this.size=new p(0,0,Math.max(i.width,1),Math.max(i.height,1)),e.width==this.size.width&&e.height==this.size.height?this.ctx.clearRect(0,0,e.width,e.height):(e.width=this.size.width,e.height=this.size.height),this}matchSize(t){const e="width"in t?t instanceof p?t:new p(0,0,t.width,t.height):t.size;return this.size.equals(e)||this.setSize(e),this}beginPath(){return this.ctx.beginPath(),this}closePath(){return this.ctx.closePath(),this}arc(t,e,i=0,s=Math.PI*2,r=!1){return this.ctx.arc(t.x,t.y,e,i,s,r),this}ellipse(t,e,i=0,s=0,r=Math.PI*2,h=!1){return this.ctx.ellipse(t.x,t.y,e.x,e.y,i,s,r,h),this}move(t){return this.ctx.moveTo(t.x,t.y),this}lineTo(t){return this.ctx.lineTo(t.x,t.y),this}bezierTo(t,e,i){return this.ctx.bezierCurveTo(t.x,t.y,e.x,e.y,i.x,i.y),this}stroke(t){return t?this.ctx.stroke(t):this.ctx.stroke(),this}fill(t){return t?this.ctx.fill(t):this.ctx.fill(),this}shape(t){let e=!0;for(const i of t){if(e){this.move(i),e=!1;continue}this.lineTo(i)}return this}setLinearGradient(t,e,i){let s=this.ctx.createLinearGradient(t.x,t.y,e.x,e.y);return i.forEach(r=>s.addColorStop(r[0],r[1])),this.setStyle(s),this}setRadialGradient(t,e,i,s,r){i==null&&(i=t),s==null&&(s=e,e=0);let h=this.ctx.createRadialGradient(t.x,t.y,e,i.x,i.y,s);return r.forEach(o=>h.addColorStop(o[0],o[1])),this.setStyle(h),this}save(){return this.ctx.save(),this}restore(){return this.ctx.restore(),this}clip(){return this.ctx.clip(),this}rect(t){return this.ctx.rect(...t.spread()),this}setStrokeWidth(t){return this.ctx.lineWidth=t,this}blit(t,e=null,i=null){if(t instanceof ImageData)return e?this.ctx.putImageData(t,e.x,e.y):this.ctx.putImageData(t,0,0),this;const s=t instanceof D?t.ctx.canvas:t;return e?e instanceof c?this.ctx.drawImage(s,...e.spread()):i?this.ctx.drawImage(s,...i.spread(),...e.spread()):this.ctx.drawImage(s,...e.spread()):this.ctx.drawImage(s,0,0),this}translate(t){return this.ctx.translate(t.x,t.y),this}rotate(t){return this.ctx.rotate(t),this}scale(t){return typeof t=="number"?this.ctx.scale(t,t):this.ctx.scale(t.x,t.y),this}transform(t){return this.ctx.transform(t.m11,t.m12,t.m21,t.m22,t.m31,t.m32),this}overrideTransform(t){return this.ctx.setTransform(t.m11,t.m12,t.m21,t.m22,t.m31,t.m32),this}setLineDash(t){return this.ctx.setLineDash(t??[]),this}setLineDashOffset(t){return this.ctx.lineDashOffset=t,this}setLineCap(t){return this.ctx.lineCap=t,this}setLineJoin(t){return this.ctx.lineJoin=t,this}setGlobalCompositeOperation(t){return this.ctx.globalCompositeOperation=t??"source-over",this}getImageData(t=this.size){return this.ctx.getImageData(t.x,t.y,t.width,t.height)}makeEmptyImageData(){return new ImageData(this.size.width,this.size.height)}setImageSmoothing(t){return this.ctx.imageSmoothingEnabled=t,this}use(t,...e){return t(this,...e),this}asPattern(t="repeat"){return this.ctx.createPattern(this.ctx.canvas,t)}};D.CONTEXT_FACTORY=()=>document.createElement("canvas").getContext("2d");let A=D;(n=>{function t(s,r,h=null,o=null){if(r instanceof c&&(r=new n().setSize(r)),s=="missing-texture"){h??(h=b.magenta),o??(o=b.black);const l=r.size.center();r.setStyle(o).fillRect().setStyle(h).fillRect(new p(c.zero,l).floor()).fillRect(new p(l,l).floor())}else s=="uv"&&(h??(h=b.red),o??(o=b.green),r.setStyle(b.black).fillRect().setGlobalCompositeOperation("lighten").setLinearGradient(c.zero,new c(r.size.width,0),[[0,"#000000"],[1,h.toHex()]]).fillRect().setLinearGradient(c.zero,new c(0,r.size.height),[[0,"#000000"],[1,o.toHex()]]).fillRect());return r}n.makeTestPattern=t;const i=class i{constructor({pos:r=c.zero,scale:h=1,shouldCenterView:o=!1}={}){this.worldToScreen=T.identity,this.screenToWorld=T.identity,this.offset=r,this.scale=h,this.shouldCenterView=o}updateViewport(r){r instanceof n&&(r=r.size);const h=this.shouldCenterView?this.offset.add(r.center()):this.offset;this.worldToScreen=T.identity.translate(h).scale(this.scale),this.screenToWorld=T.identity.scale(1/this.scale).translate(h.mul(-1))}pushTransform(r){r.save(),r.transform(this.worldToScreen)}overrideTransform(r){r.save(),r.overrideTransform(this.worldToScreen)}translate(r){this.offset=this.offset.add(r)}zoomViewport(r,h,o){const l=this.screenToWorld.transform(h);this.scale=r,this.updateViewport(o);const u=this.worldToScreen.transform(l),y=h.add(u.mul(-1));this.offset=this.offset.add(y)}};i.ZOOM_LEVELS=[1/50,1/20,1/10,1/5,1/2,1,2,5,10,20,50];let e=i;n.Camera=e})(A||(A={}));var Ft=Object.freeze({__proto__:null,get Drawer(){return A}});class ut{constructor(t){this.input=t,this.index=0}getCurrent(){return this.input[this.index]}at(t){return this.index+t<this.input.length&&this.index+t>=0?this.input[this.index+t]:""}read(t){const e=this.input.slice(this.index,this.index+t);return this.index+=t,e}skipUntil(t){if(typeof t=="string"){const e=t;t=(i,s)=>i.startsWith(e,s)}for(;this.index<this.input.length;){if(t(this.input,this.index))return!0;this.index++}return!1}readUntil(t){if(typeof t=="string"){const s=t;t=(r,h)=>r.startsWith(s,h)}let e=this.index;this.skipUntil(t);let i=this.index;return this.input.slice(e,i)}skipWhile(t){return this.skipUntil((e,i)=>!t(e,i))}readWhile(t){return this.readUntil((e,i)=>!t(e,i))}readAll(t){const e=[];for(;!this.isDone();)e.push(this.readUntil(t)),this.isDone()||(e.push(this.input[this.index]),this.index++);return e}isDone(){return this.index>=this.input.length}clone(t){const e=Object.assign(Object.create(this.constructor.prototype),this);return t!=null&&(e.input=t,e.index=0),e}restart(t){return this.input=t,this.index=0,this}consume(t){if(t instanceof Array){for(const e of t)if(this.consume(e))return e;return null}return this.input.startsWith(t,this.index)?(this.index+=t.length,!0):!1}matches(t){if(typeof t=="function")return t(this.input,this.index);if(t instanceof Array){for(const e of t)if(this.matches(e))return e;return null}return!!this.input.startsWith(t,this.index)}}var Ut=Object.freeze({__proto__:null,GenericParser:ut});function ct(){let n;if("crypto"in globalThis)n=new Uint8Array(16),globalThis.crypto.getRandomValues(n);else{n=new Array(16);for(let e=0;e<16;e++)n[e]=Math.floor(Math.random()*256)}return U(n).replace(/\//g,"_").replace(/\+/g,"-").replace(/=/g,"")}function Kt(n){return"btoa"in globalThis?globalThis.btoa(n):"Buffer"in globalThis?Buffer.from(n,"binary").toString("base64"):U(Q(n))}function Vt(n){return"atob"in globalThis?globalThis.atob(n):"Buffer"in globalThis?Buffer.from(n,"base64").toString("binary"):(()=>{throw new Error("No function found to parse base64")})()}function Wt(n,t,e){return t in n||(n[t]=e()),n[t]}function ft(n,t,e){const i=n.get(t);if(i)return i;const s=e();return n.set(t,s),s}function $t(n,t,e){let i=n[t];Object.defineProperty(n,t,{get(){return i},set(s){e(s,i),i=s}})}class qt{constructor(){this.store=new Map}get(t){return this.store.get(t)}set(t,e){this.store.set(t,e)}delete(t){return this.store.delete(t)}load(t){const e={};for(const[i,s]of Object.entries(t)){const r=this.store.get(s);if(!r)throw new RangeError(`Failed to find entry ${JSON.stringify(i)}: "${s.name}"`);e[i]=r}return e}[Symbol.iterator](){return this.store[Symbol.iterator]()}values(){return this.store.values()}keys(){return this.store.keys()}}function B(n){return n instanceof Error||(n=new Error(F(n))),n}function F(n){return typeof n=="object"&&n==null?"null":typeof n>"u"?"undefined":n.toString()}function Ht(n){return n&&typeof n=="object"?`[${n.address}]:${n.port}`:F(n)}function Gt(n){return t=>(n(t),t)}function Yt(n,t){return t(n)}function Xt(n){return isNaN(n)?null:Number(n)}function Jt(...n){return t=>t.bind(null,...n)}function Zt(n){return n.filter(t=>t).flatMap(t=>t instanceof Array?t:[t])}const k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function U(n){const t=n instanceof Array?n:new Uint8Array(W(n)),e=t.length,i=Math.ceil(e/3),s=i*4,r=new Array(s);for(let h=0;h<i;h++){const o=t[h*3+0],l=t[h*3+1],u=t[h*3+2],y=o??0,g=l??0,m=u??0,w=(y<<16)+(g<<8)+m;r[h*4+0]=k[w>>>18&63],r[h*4+1]=k[w>>>12&63],r[h*4+2]=l==null&&u==null?"=":k[w>>>6&63],r[h*4+3]=u==null?"=":k[w>>>0&63]}return r.join("")}function Qt(n){const t=n.length,e=Math.ceil(t/4),i=n.indexOf("="),s=i==-1?0:n.length-i,r=e*3-s,h=new Uint8Array(r),o=l=>{if(l==null||l=="=")return 0;const u=k.indexOf(l);if(u==-1)throw new Error("Invalid base64 character "+JSON.stringify(l));return u};for(let l=0;l<e;l++){const u=o(n[l*4+0]),y=o(n[l*4+1]),g=o(n[l*4+2]),m=o(n[l*4+3]),w=(u<<18)+(y<<12)+(g<<6)+m;h[l*3+0]=w>>>16&255,h[l*3+1]=w>>>8&255,h[l*3+2]=w&255}return h}function te(n,t){return t=typeof t=="string"?t:U(t),`data:${n};base64,${t}`}function dt({source:n,env:t={},url:e}){e&&(n+=`
//# sourceURL=`+e);const i=Object.entries(t);return new Function(...i.map(([r])=>r),n)(...i.map(([,r])=>r))}function ee(n){return new Promise(t=>setTimeout(()=>t(),n))}function ie(n){return!0}function ne(n,t=null,e=Math.random()){if(t==null){t=0;for(const s of n)t+=s.weight}let i=e*t;for(const s of n){if(i<s.weight)return s.value;i-=s.weight}throw new Error("Failed assertion: no choice picked from weighted random")}function se(n,t=null,e=Math.random()){if(t==null){t=0;for(const r of n)t+=r}let i=e*t,s=0;for(const r of n){if(i<r)return s;i-=r,s++}throw new Error("Failed assertion: no choice picked from weighted random")}function*mt(n,t){for(let e=0;e<n;e++)t?yield t(e):yield e}function yt(n,t){return Object.assign(n,t)}function re(n,t){return Object.assign(n,t)}function j(n="Reached unreachable code"){throw new Error("Assertion failed: "+n)}function he(n,t){for(const e in n)if(e[0]!=e[0].toUpperCase()&&typeof n[e]=="function"){let i=n[e];i=i.bind(n),t&&(i=t(i,e)),n[e]=i}return n}function oe(n,t){return function(...e){const i=n.bind(this);return t(i)(...e)}}const K=5,gt=1<<K,J=gt-1,Z=gt;function le(n){typeof n=="string"&&(n=n.split("").map(s=>k.indexOf(s)));const t=[];let e=0,i=0;for(const s of n){const r=s&J;if(e+=r<<i,i+=K,!(s&Z)){const h=(e&1)==1;e>>=1,t.push(h?-e:e),e=0,i=0}}return t}function ae(n,t=0){let e=0,i=0;for(;t<n.length;t++){const s=n[t],r=s&J;if(e+=r<<i,i+=K,!(s&Z)){const h=(e&1)==1;return e>>=1,t++,[h?-e:e,t]}}return[0,t]}function wt(n,t="base64"){let e=[];if(n instanceof Array)e=n.flatMap(i=>wt(i,"array"));else{n<0?n=-n<<1|1:n<<=1;do{let i=n&J;n>>>=K,n>0&&(i|=Z),e.push(i)}while(n>0)}if(t=="array")return e;if(t=="base64")return e.map(i=>k[i]).join("");if(t=="binary")return new Uint8Array(e)}function ue(n,t,e){for(;!n.startsWith(t,e)&&e>-1;)e--;return e}function*ce(n,t,e=0){for(e--;(e=n.indexOf(t,e+1))!=-1;)yield e}function fe(n,t,e=0,i=null){let s=0;for(e--;(e=n.indexOf(t,e+1))!=-1&&!(i!=null&&e>=i);)s++;return s}function pt(n,t,e,i=0){let s=0;if(e==0)return 0;for(i--;(i=n.indexOf(t,i+1))!=-1;)if(s++,s==e)return i;return-1}class de{constructor(){this.state={type:"loading"},this.promise=new Promise((t,e)=>{this.state.type=="loading"?this.state={type:"pending",reject:e,resolve:t}:this.state.type=="rejected"?e(this.state.error):this.state.type=="resolved"&&t(this.state.value)})}get pending(){return this.state.type=="pending"||this.state.type=="loading"}get resolved(){return this.state.type=="resolved"}get rejected(){return this.state.type=="rejected"}get value(){return this.state.type=="resolved"?this.state.value:null}get error(){return this.state.type=="rejected"?this.state.error:null}resolve(t){if(this.state.type=="pending")this.state.resolve(t);else if(this.state.type!="loading")throw new Error("Task already finished");this.state={type:"resolved",value:t}}reject(t){if(this.state.type=="pending")this.state.reject(t);else if(this.state.type!="loading")throw new Error("Task already finished");this.state={type:"rejected",error:t}}completeWith(t){t().then(e=>this.resolve(e),e=>this.reject(e))}then(...t){return this.promise.then(...t)}catch(...t){return this.promise.catch(...t)}finally(...t){return this.promise.finally(...t)}asPromise(){return this.promise}}function Q(n){const t=new Uint8Array(n.length);for(let e=0,i=n.length;e<i;e++){let s=n.charCodeAt(e);t[e]=s}return t}const me=Q,ye=xt;function ge(n){const t=new Uint16Array(n.length);for(let e=0,i=n.length;e<i;e++){let s=n.charCodeAt(e);t[e]=s}return t}function xt(n){const t=n instanceof Array?n:new Uint8Array(W(n));return String.fromCharCode(...t)}function we(n){const t=n instanceof Array?n:new Uint16Array(W(n));return String.fromCharCode(...t)}function*pe(n,t){let e=0;for(const i of n)yield t(i,e++)}function*xe(n,t){let e=0;for(const i of n)yield*t(i,e++)}function _e(n,t){let e=0;for(const i of n)if(t(i,e++))return i;return null}function*be(n,t){const e=Symbol.iterator in n?n[Symbol.iterator]():n;for(let i=0;i<t;i++){const s=e.next();if(s.done)return;yield s.value}}function*ve(n,t){const e=Symbol.iterator in n?n[Symbol.iterator]():n;for(let i=0;i<t;i++)if(e.next().done)return;for(;;){const i=e.next();if(i.done)return;yield i.value}}function Se(n,t){const e=[];for(let i=0,s=n.length;i<s;i++){const r=n[i];if(t(r,i))e.push([r,[]]);else if(e.length>0)e[e.length-1][1].push(r);else throw new Error("Not header first element in unzip")}return e}function Me(n,t){return n==t?null:n}const je="0".charCodeAt(0),Ee="9".charCodeAt(0),_t="a".charCodeAt(0),bt="z".charCodeAt(0),vt="A".charCodeAt(0),St="Z".charCodeAt(0);function Mt(n,t=0){if(!n)return!1;const e=n.charCodeAt(t);return e>=je&&e<=Ee}function jt(n,t=0){if(!n)return!1;const e=n.charCodeAt(t);return e>=_t&&e<=bt||e>=vt&&e<=St}function Te(n,t=0){if(!n)return!1;const e=n.charCodeAt(t);return e>=_t&&e<=bt}function Et(n,t=0){if(!n)return!1;const e=n.charCodeAt(t);return e>=vt&&e<=St}function Ae(n,t=0){return!n||!n[t]?!1:jt(n,t)||Mt(n,t)||n[t]=="_"}function ke(n,t=0){return n[t]==" "||n[t]=="\r"||n[t]=="	"||n[t]==`
`}function tt(n){return[].concat(n)}function ze(n,t){let e=n.length-1;for(let i=0;i<=e;)t(n[i])?i++:(n[i]=n[e],e--);return n.length=e+1,n}function Oe(n){const t={};return Object.defineProperties(t,Object.fromEntries(Object.keys(n).map(e=>[e,{get:()=>n[e],set:i=>n[e]=i}]))),t}function V(n,t){let e=0,i=n.length-1;for(;e<=i;){const s=i+e>>1,r=t(n[s]);if(r>0)e=s+1;else if(r<0)i=s-1;else return s}return-e-1}function et(n,t,e){const i=V(t,s=>e(n,s));i>=0?t.splice(i+1,0,n):t.splice(-i-1,0,n)}function Ce(n,t,e){const i=V(t,s=>e(n,s));i>=0?t.splice(i+1,0,n):t.splice(-i-1,0,n)}const Ie=yt;function Ne(n,t,e){const i=[];n=n.toLowerCase();let s=0;for(let r of t){const h=e(r,s++,t).toLowerCase();let o=0,l=0;for(let u=0;u<h.length&&l!=n.length;u++)h[u]==n[l]?l++:o++;l==n.length&&et({option:r,cost:o},i,(u,y)=>u.cost-y.cost)}return i}function Re(n){return n.replace(/^./,t=>t.toLowerCase()).replace(/[A-Z]/g,t=>"_"+t.toLowerCase())}function Tt(n){return n.replace(/_([a-z])/,(t,e)=>e.toUpperCase())}function Pe(n){return Tt(n).replace(/^./,t=>t.toUpperCase())}function Le(n){return n.replace(/^./,t=>t.toLowerCase()).replace(/[A-Z]/g,t=>" "+t).replace(/^./,t=>t.toUpperCase())}function De(n,t,e){const s=new ut(n).readAll(t=="camel"||t=="pascal"?(h,o)=>Et(h[o]):t=="snake"?(h,o)=>h[o]=="_":t=="const"?(h,o)=>h[o]=="_":t=="kebab"?(h,o)=>h[o]=="-":t=="title"?(h,o)=>h[o]==" ":j()),r=[];for(let h=0;h<s.length;h++){if(h%2==1)continue;let o=s[h];h!=0&&(t=="camel"||t=="pascal"||t=="title")&&(o=s[h-1].toLowerCase()+o),t=="const"&&(o=o.toLowerCase()),r.push(o)}if((t=="title"||t=="pascal")&&r.shift(),e=="array")return r;if(e=="kebab")return r.join("-");if(e=="snake")return r.join("_");if(e=="const")return r.join("_").toUpperCase();for(let h=0;h<r.length;h++)e=="camel"&&h==0||(r[h]=r[h][0].toUpperCase()+r[h].slice(1));if(e=="camel"||e=="pascal")return r.join("");if(e=="title")return r.join(" ");j()}function*Be(...n){for(const t of n)yield*t}function*Fe(n,...t){const e=t.map(i=>i[Symbol.iterator]());for(;;){let i=!1,s=!0;const r=[];for(const h of e){const o=h.next();o.done?(i=!0,r.push(null)):(s=!1,r.push(o.value))}if(n=="until-first"&&i)return;if(s)return;yield r}}function Ue(n,t){function e(i,s,r){const h=t(i,s,r);if(h!=null&&typeof h=="object")if(h instanceof Array){const o=new Array(h.length);for(let l=0;l<h.length;l++)o[l]=e(h,l,h[l]);return o}else{const o={};for(const[l,u]of Object.entries(h))o[l]=e(o,l,u);return o}return h}return e(null,"",n)}function Ke(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function Ve(n){return n.replace(/[^\w ]/g,t=>t=="\\"?"\\\\":`\\u${t.charCodeAt(0).toString(16).padStart(4,"0")}`)}function We(n,t=0){"next"in n||(n=n[Symbol.iterator]());for(let e=0;;e++){const i=n.next();if(i.done)throw new RangeError("Iterator ended before nth result was reached");if(e==t)return i.value}}function $e(n,t=0){return"next"in n||(n=n[Symbol.iterator]()),n.next().done}function qe(n,t){const e=Object.create(null);for(const i of n)e[i[t]]=i;return e}function He(n,t){const e=new Map;for(const i of n){const s=i[t];if(e.has(s))throw new RangeError(`Duplicate key "${s}"`);e.set(s,i)}return e}function W(n){return ArrayBuffer.isView(n)?n.buffer:n}function Ge(n,t){let e="";for(let i=0;i<t;i++)e+=n;return e}function Ye(n){return Object.assign(Object.create(null),n)}function Xe(n,t,e){const i=e-t;return n=n-t,n<0&&(n=i+n%i),n%i}function Je(n,t,e){return n>e&&(n=e),n<t&&(n=t),n}function Ze(n,t,e,i,s){return(n-t)/(e-t)*(s-i)+i}function Qe(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n=="object"&&n==null}function ti(n,t,e){return n*(1-e)+t*e}function $(n){return Object.assign(Object.create(Object.getPrototypeOf(n)),n)}function ei(n,...t){const e=$(n);for(const i of t)delete e[i];return e}function ii(n,t){return Object.assign($(n),t)}function ni(n,...t){const e={};for(const i of t)e[i]=n[i];return e}function si(n,...t){return new n(...t)}function ri(n,t,e){const i=(s,r)=>{const h=t(s,r);for(const o of h)i(o,r+1);e==null||e(s,r)};i(n,0)}function hi(n,t,e=0){let i=-1,s=0;for(let r=e;r<n.length;r++)if(n[r]==t[s]){if(i==-1&&(i=r),s++,s==t.length)return i}else i!=-1&&(i=-1,s=0);return-1}var it;(n=>{function t(s){return s==null?(r,h)=>r+h:(r,h)=>r+s(h)}n.sum=t;function e(s){return(r,h,o)=>{const l=s==null?h:s(h);if(r==null)return{value:l,element:h,index:o};const u=r.value;return l<u?{value:l,element:h,index:o}:r??j()}}n.smallest=e;function i(s){return(r,h,o)=>{const l=s==null?h:s(h);if(r==null)return{value:l,element:h,index:o};const u=r.value;return l>u?{value:l,element:h,index:o}:r??j()}}n.largest=i})(it||(it={}));function*oi(n){for(let t=n.length-1;t>=0;t--)yield n[t]}function nt(n,t){const e=n.indexOf(t);return e==-1?!1:(n.splice(e,1),!0)}function li(...n){return(...t)=>n.map(e=>e(...t))}var st;(n=>{function t(o){return l=>l instanceof o}n.instanceOf=t;function e(o){return l=>typeof l==o}n.typeOf=e;function i(o){return o==null?l=>!1:"has"in o?l=>o.has(l):l=>o.includes(l)}n.containedIn=i;function s(o){return(...l)=>!o(...l)}n.invert=s;function r(){return o=>o!=null}n.notNull=r;function h(...o){return l=>{for(const u of o)if(!u(l))return!1;return!0}}n.and=h,n.not=new Proxy({},{get(o,l,u){const y=n[l];return(...g)=>{const m=y(...g);return(...w)=>!m(...w)}}})})(st||(st={}));function ai(n,t,{maxAttempts:e=1e3}={}){let i,s=0;do if(i=n(),s++,e!=null&&s>e)throw new RangeError("Search reached maximum attempts");while(!t(i));return i}function ui(n,t){return Object.fromEntries(typeof t=="string"?Object.entries(n).map(([e,i])=>[e,i[t]]):Object.entries(n).map(([e,i])=>[e,t(i,e,n)]))}function ci(n,t){return typeof t=="string"?new Map([...n].map(([e,i])=>[e,i[t]])):new Map([...n].map(([e,i])=>[e,t(i,e,n)]))}function fi(n){return typeof n=="function"&&n.toString().startsWith("class")}function di(n,t){const e=tt(n);return nt(e,t),e}function mi(n,...t){for(const e of t)n.includes(e)||n.push(e)}function yi(n,t){const e=[...mt(t,()=>[])];let i=0;for(const s of n)e[i%t].push(s),i++;return e}function gi(n,t){const e=[],i=[];for(const s of n)t(s)?i.push(s):e.push(s);return[e,i]}function wi(n,t){for(const e of t)if(n=n[e],n==null)return null;return n}function pi(n,t,e){t=tt(t);let i=n;for(let s=0;s<t.length-1;s++){let r=t[s];typeof(s+1<t.length?t[s+1]:null)=="number"?i[r]??(i[r]=[]):i[r]??(i[r]={}),typeof r=="number"&&(r<0&&(r=i.length+r),(r<0||r>=i.length)&&(r=i.length)),i=i[r]}i[t[t.length-1]]=e}function xi(n){return class extends n{constructor(t){super(),Object.assign(this,t)}}}function*_i(n,t){let e=!0,i=null;for(const s of n){if(e){i=s,e=!1,yield s;continue}typeof t=="function"?yield t(i,s):yield t,yield s,i=s}}function bi(n,t){return(e,i)=>{const s=n(e),r=n(i),h=s>r?1:s<r?-1:0;return t=="ascending"?h:-h}}function vi(n,t){const e=new Map(n);for(const[i,s]of t)e.set(i,s);return e}function Si(n,t){for(const[e,i]of t)n.set(e,i);return n}function Mi(n){let t=0;for(const s of n)t+=s.byteLength;const e=new Uint8Array(t);let i=0;for(const s of n){const r=ArrayBuffer.isView(s)?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s);e.set(r,i),i+=s.byteLength}return e}function ji(n){const t=Math.clz32(n)-1,e=1073741824>>t;return n==e?n:(2147483647>>t)+1}function*Ei(n){let t=0;for(const e of n)yield[e,t],t++}async function Ti(n){const t=[];for await(const e of n)t.push(e);return t}function At(n,t){if(t==null)return n;if(typeof n=="object"&&n!=null){if(n instanceof Array)return n.push(...t),n;for(const[e,i]of Object.entries(t)){const s=e in n?n[e]:void 0;if(typeof s=="object"&&s!=null){n[e]=At(s,i);continue}n[e]=i}return n}return t}function Ai(n,t){return n<0?-Math.pow(Math.abs(n),t):Math.pow(n,t)}let q=null;function ki(){if(q==null)return q=performance.now(),"0ms";const n=performance.now(),t=q;q=n;const e=n-t;return e<1e3?`+${e|0}ms`:`+${(e/1e3).toFixed(2)}s`}function zi(n=null){let t=[];const e=[];let i=0;function s(){if(i--,e.length>0&&(n==null||i<n)){const r=e.shift();t.push(r().finally(s))}}return{push(r){n==null||i<n?(i++,t.push(r().finally(s))):e.push(r)},async join(){for(;t.length>0;){const r=t;t=[],await Promise.all(r)}}}}function Oi(n){return()=>n()}var Ci=Object.freeze({__proto__:null,get Predicate(){return st},get Reducers(){return it},Task:de,TypedMap:qt,arrayExclude:di,arrayPushUnique:mi,arrayRemove:nt,asError:B,asciiToBinary:me,assertType:ie,asyncConcurrency:zi,asyncReadAll:Ti,autoFilter:Zt,binarySearch:V,bindObjectFunction:he,bufferConcat:Mi,cachedSupplier:Oi,camelToSnakeCase:Re,camelToTitleCase:Le,cloneArray:tt,cloneWith:ii,cloneWithout:ei,convertCase:De,countOccurrences:fe,createShadowObject:Oe,createSortFunction:bi,decodeAscii:xt,decodeUTF16:we,deepObjectApply:At,delayedPromise:ee,elapsedTime:ki,encodeAscii:Q,encodeUTF16:ge,ensureArrayBuffer:W,ensureKey:ft,ensureProperty:Wt,escapeHTML:Ke,escapeRegex:Ve,executeProtectedConstructor:si,extend:re,findNthOccurrence:pt,findOccurrences:ce,findSequence:hi,fromBase64:Vt,fromBase64Binary:Qt,fuzzySearch:Ne,getValueByPath:wi,iPairs:Ei,insertSorted:et,insertSortedWithoutDuplicates:Ce,isAlpha:jt,isClassCtor:fi,isIteratorEmpty:$e,isLowerCase:Te,isNumber:Mt,isPrimitiveValue:Qe,isUpperCase:Et,isWhitespace:ke,isWord:Ae,iterableFind:_e,iterableFlatMap:xe,iterableInterject:_i,iterableMap:pe,iterableSkip:ve,iterableTake:be,iteratorNth:We,joinIterable:Be,joinIterableParallel:Fe,lerpNumber:ti,makeBound:Jt,makeDataURL:te,makeLookupObject:Ye,makeMapByKeyProperty:He,makeObjectByKeyProperty:qe,makePropertyObserver:$t,makeRandomID:ct,mapAppend:Si,mapConcat:vi,mapMap:ci,modify:yt,multicast:li,mutate:Ie,nearestPowerOf2:ji,objectMap:ui,partitionSequence:gi,pick:ni,powWithNegativeNumbers:Ai,quickFilter:ze,range:mt,rangeClamp:Je,rangeOverflow:Xe,recordClass:xi,remap:Ze,repeatString:Ge,reverseIndexOf:ue,reverseIterate:oi,runString:dt,searchUntil:ai,setValueByPath:pi,shallowClone:$,sideEffect:Gt,snakeToCamelCase:Tt,snakeToPythonCase:Pe,splitBetween:yi,stringifyAddress:Ht,toBase64:Kt,toBase64Binary:U,toString:F,transform:Yt,transformTree:Ue,uint8ToAscii:ye,unreachable:j,unzip:Se,visitTree:ri,vlqDecode:le,vlqDecodeOne:ae,vlqEncode:wt,voidNaN:Xt,voidValue:Me,weightedRandom:ne,weightedRandomI:se,wrapFunction:oe});const R=class R{constructor(){this._handlers=[]}appendHandler(t){return this._handlers.push(t),t}prependHandler(t){return this._handlers.unshift(t),t}removeHandler(t){return nt(this._handlers,t)}evaluate(t){for(const e of this._handlers){let i=e(t,R.NEXT);if(i!=R.NEXT)return i}return R.NEXT}};R.NEXT=Symbol.for("kompa.chain.next");let rt=R;var Ii=Object.freeze({__proto__:null,Chain:rt});const Ni=new Map;class v{constructor(t,e){this.keyTypes=e,this.sharedKeys=new Map,this.reverseKeys=new Map,this.uniqueKeys=new Map;for(const[i,s]of Object.entries(e))s.shared?this.sharedKeys.set(i,new Map):this.uniqueKeys.set(i,new Map)}get size(){return this.reverseKeys.size}tryGet(t,e){const i=this.keyTypes[t];if(i==null)throw new RangeError(`Invalid key type ${JSON.stringify(i)}`);return(i.shared?this.sharedKeys.get(t):this.uniqueKeys.get(t)).get(e)??(i.shared?Ni:null)}get(t,e){const i=this.tryGet(t,e);if(i==null)throw new RangeError("Cannot find value with key");return i}add(t){var i;if(this.reverseKeys.has(t))return!1;const e=new Map;this.reverseKeys.set(t,e);for(const[s,r]of Object.entries(this.keyTypes)){let h=((i=r.generator)==null?void 0:i.call(r,t))??t[s];e.set(s,h),r.multiple||(h=[h]);for(const o of h)if(r.shared)ft(this.sharedKeys.get(s),o,()=>new Set).add(t);else{const l=this.uniqueKeys.get(s);if(l.has(o))throw new RangeError("Entity with duplicate key");l.set(o,t)}}return!0}delete(t){const e=this.reverseKeys.get(t);if(e==null)return!1;this.reverseKeys.delete(t);for(let[i,s]of e){const r=this.keyTypes[i];r.multiple||(s=[s]);for(const h of s)if(r.shared){const o=this.sharedKeys.get(i),l=o.get(h);l.delete(t),l.size==0&&o.delete(i)}else this.uniqueKeys.get(i).delete(h)}return!0}update(t){if(!this.delete(t))throw new RangeError("Entity is not stored in the map");this.add(t)}has(t){return this.reverseKeys.has(t)}[Symbol.iterator](){return this.reverseKeys[Symbol.iterator]()}values(){return this.reverseKeys.keys()}clear(){this.reverseKeys.clear();for(const t of this.sharedKeys.values())t.clear();for(const t of this.uniqueKeys.values())t.clear()}static type(t,e){return class extends v{constructor(){super(t,e)}}}}(n=>{function t(o=null){return{shared:!1,multiple:!1,generator:o}}n.key=t;function e(o=null){return{shared:!0,multiple:!1,generator:o}}n.sharedKey=e;function i(o=null){return{shared:!1,multiple:!0,generator:o}}n.multipleKey=i;function s(o=null){return{shared:!0,multiple:!0,generator:o}}n.sharedMultipleKey=s;function r(){return t(()=>ct())}n.autoKey=r;function h(){return null}n.entity=h})(v||(v={}));var Ri=Object.freeze({__proto__:null,get MultiMap(){return v}});function ht(n,t){let e=n.id,i=t.id;return e>i&&([e,i]=[i,e]),e+">"+i}class C{constructor(t,e){if(this._nodes=new Set,this._nextID=0,this._edges=new v(v.entity(),{from:v.sharedKey(),to:v.sharedKey(),connects:v.sharedMultipleKey(i=>[i.from,i.to]),id:v.key()}),t){const i=new Map;for(const s of t.nodes()){const r=new C.Node(this,e?e(s.userData):s.userData,s.id);i.set(r.id,r),this._nodes.add(r)}for(const s of t.edges()){const r=i.get(s.from.id),h=i.get(s.to.id);this.addEdge(r,h)}this._nextID=t._nextID}}addNode(t){const e=new C.Node(this,t);return this._nodes.add(e),e}removeNode(t){this._nodes.delete(t);for(const e of this._edges.get("connects",t))this._edges.delete(e)}nodes(){return this._nodes[Symbol.iterator]()}edges(){return this._edges.values()}get size(){return this._nodes.size}addEdge(t,e){if(!this._nodes.has(t))throw new RangeError("Graph does not have node");if(!this._nodes.has(e))throw new RangeError("Graph does not have node");if(t==e)throw new RangeError("Cannot create edge to self");const i={from:t,to:e,id:ht(t,e)};if(this._edges.tryGet("id",i.id)==null)return this._edges.add(i),i}removeEdge(...t){let e;if(t.length==1)e=t[0];else{const[i,s]=t,r=ht(i,s);e=this._edges.get("id",r)}return this._edges.delete(e)}hasEdge(t,e){const i=ht(t,e);return this._edges.tryGet("id",i)!=null}hasNode(t){return this._nodes.has(t)}clear(){this._edges.clear(),this._nodes.clear(),this._nextID=0}clearEdges(){this._edges.clear()}}(n=>{class t{constructor(i,s,r=i._nextID++){this.graph=i,this.userData=s,this.id=r}neighbours(){return new Set([...this.graph._edges.get("connects",this)].map(({from:i,to:s})=>i==this?s:i))}destroy(){this.graph.removeNode(this)}isConnectedTo(i){return this.graph.hasEdge(this,i)}}n.Node=t})(C||(C={}));var Pi=Object.freeze({__proto__:null,get Graph(){return C}});const z=Symbol.for("kompa.imList.empty"),_=class _{constructor(t=z,e=null,i=null){this._value=t,this._prev=e,this._next=i,this.length=(t==z?0:1)+(this._prev!=null?this._prev.length:0)+(this._next!=null?this._next.length:0)}add(t){return this.length==0?new _(t,null,null):new _(t,this,null)}addStart(t){return this.length==0?new _(t,null,null):new _(t,null,this)}*[Symbol.iterator](){this.length!=0&&(this._prev&&(yield*this._prev[Symbol.iterator]()),this._value!=z&&(yield this._value),this._next&&(yield*this._next[Symbol.iterator]()))}concat(t){return this.length==0?t:t.length==0?this:this.length==1?new _(this._value,null,t):t.length==1?new _(t._value,this,null):new _(z,this,t)}toArray(){return[...this]}reduce(t,e){let i=e,s=0;for(const r of this)i=t(i,r,s);return i}join(t){return this.toArray().join(t)}getFirst(){if(this.length==0)throw new RangeError("Cannot get first value of an ImmutableList");return this._prev?this._prev.getFirst():(this._value==z&&j(),this._value)}getLast(){if(this.length==0)throw new RangeError("Cannot get last value of an ImmutableList");return this._next?this._next.getLast():(this._value==z&&j(),this._value)}static from(t){let e=null;if(t)for(const i of t)e==null?e=new _(i,null,null):e=new _(i,e,null);return e??this.empty()}static empty(){return this._EMPTY_LIST}};_._EMPTY_LIST=new _(z,null,null);let ot=_;var Li=Object.freeze({__proto__:null,ImmutableList:ot});class M{constructor(t){if(this.start=null,this.end=null,t!=null)for(const e of t)this.push(e)}push(t){return this.end?this.end=this.end.next=new M.Node(t,this.end,null):this.start=this.end=new M.Node(t,null,null)}unshift(t){return this.start?this.start=this.start.prev=new M.Node(t,this.start,null):this.start=this.end=new M.Node(t,null,null)}pop(){if(!this.end)return null;const t=this.end;return this.end=this.end.prev,t}shift(){if(!this.start)return null;const t=this.start;return this.start=this.start.next,t}insert(t,e){if(!t)return this.unshift(e);const i=new M.Node(e,t,t.next);return t.next&&(t.next.prev=i),t.next=i,t==this.end&&(this.end=i),i}delete(t){t.next&&(t.next.prev=t.prev),t.prev&&(t.prev.next=t.next),t==this.end&&(this.end=t.prev),t==this.start&&(this.start=t.next)}deleteRange(t,e){t??(t=this.start),e??(e=this.end),!(t==null||e==null)&&(e.next&&(e.next.prev=t.prev),t.prev&&(t.prev.next=e.next),e==this.end&&(this.end=t.prev),t==this.start&&(this.start=e.next))}clear(){this.end=null,this.start=null}isEmpty(){return this.start==null}*[Symbol.iterator](){for(let t=this.start;t!=null;t=t.next)yield[t,t.value]}*values(){for(let t=this.start;t!=null;t=t.next)yield t.value}*keys(){for(let t=this.start;t!=null;t=t.next)yield t}}(n=>{class t{constructor(i,s,r){this.value=i,this.prev=s,this.next=r}*[Symbol.iterator](){for(let i=this;i!=null;i=i.next)yield[i,i.value]}*values(){for(let i=this;i!=null;i=i.next)yield i.value}*keys(){for(let i=this;i!=null;i=i.next)yield i}}n.Node=t})(M||(M={}));var Di=Object.freeze({__proto__:null,get LinkedList(){return M}});class E extends Error{constructor(){super(...arguments),this.name="PredicateFailedError"}}class kt extends Error{constructor(){super(...arguments),this.name="ErrorResultUnwrapError"}}class x{constructor(t){this._rejected=null,this._value=t}get rejected(){return this._rejected}else(t){if(this._rejected){const e=t(this._rejected);e instanceof x?e._rejected?(this._value=null,this._rejected=e._rejected):(this._value=e._value,this._rejected=null):(this._value=e,this._rejected=null)}return this}effect(t,...e){return this._rejected?this:(t(this._value,...e),this)}unwrap(){if(this._rejected)throw this._rejected;return this._value}tryUnwrap(){if(!this._rejected)return this._value}unwrapOrError(){return this._rejected?this._rejected:this._value}do(t,...e){if(!this._rejected){const i=t(this._value,...e);i instanceof x?i._rejected?this._rejected=i._rejected:this._value=i._value:this._value=i}return this}try(t,...e){if(!this._rejected)try{const i=t(this._value,...e);i instanceof x?i._rejected?this._rejected=i._rejected:this._value=i._value:this._value=i}catch(i){this._rejected=B(i),this._value=null}return this}filter(t,e="Value did not match predicate"){return this._rejected?this:(t(this._value)||(this._rejected=new E(e),this._value=null),this)}assertType(){return this}rejectType(t,e=`Value was of type "${t.name}"`){return this._rejected?this:(this._value instanceof t&&(this._rejected=new E(e),this._value=null),this)}notNull(){return this._rejected?this:(this._value==null&&(this._rejected=new E("Value is null"),this._value=null),this)}notNaN(){return this._rejected?this:((typeof this._value!="number"||isNaN(this._value))&&(this._rejected=new E("Value is NaN"),this._value=null),this)}filterType(t,e=`Value was not of type "${typeof t=="string"?t:t.name}"`){return this._rejected?this:(typeof t=="string"?typeof this._value!=t&&(this._rejected=new E(e),this._value=null):this._value instanceof t||(this._rejected=new E(e),this._value=null),this)}rejectValue(t,e=`Value was "${F(t)}"`){return this._rejected||this._value==t&&this._value==t&&(this._rejected=new E(e),this._value=null),this}pcall(t,...e){if(this._rejected)return this;try{return x.value(t(this._value,...e))}catch(i){return x.rejected(B(i))}}static value(t){return new x(t)}static rejected(t){const e=new x(null);return e._rejected=t,e}static pcall(t,...e){try{return x.value(t(...e))}catch(i){return x.rejected(B(i))}}}class H{constructor(){this._error=null,this._value=null}get error(){return this._error}_getError(){return new kt(`Tried to unwrap result with error of "${this._error.kind}"`)}unwrap(){if(this._error!=null)throw this._getError();return this._value}toOptional(){return this._error?x.rejected(this._getError()):x.value(this._value)}static error(t,e){const i=new H;return i._error={...e,kind:t},i}static value(t){const e=new H;return e._value=t,e}}var Bi=Object.freeze({__proto__:null,ErrorResultUnwrapError:kt,Optional:x,PredicateFailedError:E,Result:H});const G=4294967296,lt=23283064365386963e-26;class zt{constructor(){this._state=4022871197}addInt(t){let e=this._state+(t|0),i=.02519603282416938*e;return e=i>>>0,i-=e,i*=e,e=i>>>0,i-=e,e+=i*G,this._state=e,this}addFloat(t){const e=new Float64Array(1),i=new Uint32Array(e.buffer);return e[0]=t,this.addInt(i[0]),this.addInt(i[1]),this}addString(t){for(let e=0;e<t.length;e++)this.addInt(t.charCodeAt(e));return this}getCode(){return this._state}getFloat(){return(this._state>>>0)*lt}}class Y{nextInt(){return this.next()*G}nextRange(t,e){return this.next()*(e-t)+t}nextBoolean(){return this.next()>.5}nextElement(t){return t[this.nextRange(0,t.length)|0]}getFactory(){return()=>this.next()}}class Ot{next(){let t=2091639*this.s0+this.c*lt;return this.s0=this.s1,this.s1=this.s2,this.c=t|0,this.s2=t-this.c,this.s2}nextInt(){return this.next()*G}nextRange(t,e){return this.next()*(e-t)+t}nextBoolean(){return this.next()>.5}nextElement(t){return t[this.nextRange(0,t.length)|0]}getFactory(){return()=>this.next()}constructor(t=Date.now()){const e=new zt;typeof t=="object"&&(t=t.getCode()),e.addFloat(t),this.s0=e.getFloat(),e.addInt(e.getCode()),this.s1=e.getFloat(),e.addInt(e.getCode()),this.s2=e.getFloat(),this.c=1}}class Fi extends Y{next(){return Math.random()*G}}class Ui extends Y{constructor(t){super(),this.state=t}next(){return this.nextInt()*lt}nextInt(){return this.state=Math.imul(this.state,1103515245)+12345&2147483647}}class Ki{constructor(t=Date.now()){return new Ot(t)}static[Symbol.hasInstance](t){return t instanceof Y}}var Vi=Object.freeze({__proto__:null,AleaRandom:Ot,HashCode:zt,LcgRandom:Ui,MathRandom:Fi,Random:Ki,_Random:Y});class X{constructor(t){this.comparator=t,this.array=[]}get length(){return this.array.length}get(t){return t<0?this.array[this.array.length+t]:this.array[t]}add(t){et(t,this.array,this.comparator)}indexOf(t){let e=V(this.array,i=>this.comparator(t,i));if(e<0)return-1;for(;e<this.length;){if(this.array[e]==t)return e;if(e++,this.comparator(t,this.array[e])!=0)break}return-1}contains(t){return this.indexOf(t)!=-1}delete(t){const e=this.indexOf(t);return e<0?!1:(this.array.splice(e,1),!0)}splice(t,e,...i){e==null?this.array.splice(t):this.array.splice(t,e);for(const s of i)this.add(s)}clear(){this.array.length=0}map(t,e){return this.array.map(t,e)}[Symbol.iterator](){return this.array[Symbol.iterator]()}static adopt(t,e){const i=new X(e);return i.array=t,i}static from(t,e){const i=[...t],s=new X(e);return s.array=i,s}}var Wi=Object.freeze({__proto__:null,SortedArray:X});const O=-1,Ct=-2;class $i{constructor(){this._target=null,this._result=null,this._index=-1,this._value=null,this.wasDropped=!1}get wasModified(){return this._target!=this._result}isDone(){return this._index==O?!1:this._index==Ct?!0:!(this._index<this._target.length)}next(){if(this.wasDropped=!1,this._index==O)return this._result=this._target,this._target=null,this._index=Ct,this._value=this._result;if(this._index>=0&&this._index<this._target.length){const t=this._target[this._index++];return this.wasModified&&this._result.push(t),this._value=t}throw new RangeError("No more elements available")}peek(){if(this._index==O)return this._target;if(this._index>=0&&this._index<this._target.length)return this._target[this._index];throw new RangeError("No more elements available")}drop(){this.wasDropped||(this.wasDropped=!0,this._index<=O?this._result=null:this._index>=0&&(this.wasModified?this._result.pop():this._result=this._target.slice(0,this._index-1)))}replace(t){if(this._value=t,this.wasDropped){this.wasDropped=!1,this._index<=O?this._result=t:this._result.push(t);return}this._index<=O?this._result=t:this._index>=0&&(this.wasModified?this._result.splice(-1,1,t):this._result=[...this._target.slice(0,this._index-1),t])}transform(t){return this._index=O,this._target=t,this._result=t,this.process(),this._result}transformArray(t){return this._index=0,this._target=t,this._result=t,this.process(),this._result}processChildren(t){const e=this._getChildren();if(e==null)return;const i=$(this);t&&Object.assign(i,t);const s=i.transformArray(e);i.wasModified&&this.applyChildren(s)}process(){for(;!this.isDone();)this.next(),this.processElement()}processElement(){this.processChildren()}}var qi=Object.freeze({__proto__:null,Transformer:$i});const Hi=[],Gi=new Set,Yi=new Map,Xi=n=>n,Ji=()=>{},Zi={next(){return{value:void 0,done:!0}},return(n){return{value:n,done:!0}},throw(n){throw n},[Symbol.iterator](){return this}};var Qi=Object.freeze({__proto__:null,EMPTY_ARRAY:Hi,EMPTY_ITERATOR:Zi,EMPTY_MAP:Yi,EMPTY_SET:Gi,NOOP:Xi,VOID:Ji}),tn=Object.freeze({__proto__:null});A.CONTEXT_FACTORY=()=>new OffscreenCanvas(256,256).getContext("2d")??j("Offscreen 2D Canvas is not supported by your browser");let It=null,I=null,N=c.one;Object.assign(self,...Object.values(Object.assign({"../drawer/Color.ts":Pt,"../drawer/Drawer.ts":Ft,"../drawer/Matrix.ts":Bt,"../drawer/Point.ts":Lt,"../drawer/Rect.ts":Dt})),...Object.values(Object.assign({"../comTypes/Chain.ts":Ii,"../comTypes/GenericParser.ts":Ut,"../comTypes/Graph.ts":Pi,"../comTypes/ImmutableList.ts":Li,"../comTypes/LinkedList.ts":Di,"../comTypes/MultiMap.ts":Ri,"../comTypes/Optional.ts":Bi,"../comTypes/Random.ts":Vi,"../comTypes/SortedArray.ts":Wi,"../comTypes/Transformer.ts":qi,"../comTypes/const.ts":Qi,"../comTypes/types.ts":tn,"../comTypes/util.ts":Ci})),{mouse:c.zero,pressed:!1});let P="",L=null,Nt=performance.now();setInterval(()=>{const n=performance.now(),t=n-Nt;Nt=n,Rt(()=>L==null?void 0:L(t))},17);function Rt(n){try{n()}catch(t){console.error(t);const e=t.stack,i=new RegExp("code\\.js:(\\d+):(\\d+)"),s=e.match(i)??t.message.match(i);let r="";if(s){const[h,o]=s.slice(1,3).map(m=>+m),l=h==1?0:pt(P,`
`,h-1),u=P.indexOf(`
`,l+1),y=P.slice(l,u==-1?P.length:u),g=" ".repeat(o-1)+"^";r=y+`
`+g+`

`}postMessage({kind:"error",error:r+e})}}self.addEventListener("message",async n=>{const t=n.data;if(t.kind=="ping")self.postMessage({kind:"pong"});else if(t.kind=="canvas")It=t.canvas,I=new A(It.getContext("2d")),N=new c(t.size),I.setSize(N);else if(t.kind=="resize"){if(I==null||!I.size.size().equals(N))return;const e=new c(t.size);if(e.equals(N))return;N=e,I.setSize(N)}else t.kind=="code"?(P=`

`+t.code,L=null,Rt(()=>{const e=dt({source:t.code+`
return { init, update }`,env:{init:null,update:null,drawer:I},url:"virtual://thread/code.js"});typeof e=="object"&&e!=null&&(typeof e.init=="function"&&e.init(),typeof e.update=="function"&&(L=e.update))})):t.kind=="mousemove"?self.mouse=new c(t.pos):t.kind=="mousedown"?self.pressed=!0:t.kind=="mouseup"&&(self.pressed=!1)})})();
